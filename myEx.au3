

if $RunRound = "7" Then
	run("zaZA_Setup_en.exe")
	TraySetToolTip("Waiting for ZA setup to startup")
	WinWaitActive("ZoneAlarm Installation","Installation")
	ControlClick("ZoneAlarm Installation","","[CLASS:Button; INSTANCE:6]")
	Send("!n",0)
	TraySetToolTip("Waiting for ZA registration dialog")
	WinWaitActive("ZoneAlarm Registration")
	ControlSetText("ZoneAlarm Registration","","[CLASS:Edit; INSTANCE:1]","test")
	ControlSetText("ZoneAlarm Registration","","[CLASS:Edit; INSTANCE:2]","test@test.com")
	ControlClick("ZoneAlarm Registration","","[CLASS:Button; INSTANCE:1]")
	Send("!n",0)
	TraySetToolTip("Waiting for ZA installation to continue")
	WinWaitActive("ZoneAlarm Installation")
	Send("!a",0)
	ControlClick("ZoneAlarm Installation","","[CLASS:Button; INSTANCE:4]")
	Send("!i",0)
	TraySetToolTip("Waiting for ZA installation to finish")
	while True
		if WinExists("Windows Security") Then
			WinActivate("Windows Security")
			ControlClick("Windows Security","","[CLASS:Button; INSTANCE:1]")
		endif
		if WinExists("Configuration Wizard") Then
			WinActivate("Configuration Wizard")
			WinWaitActive("Configuration Wizard")
			ExitLoop
		EndIf	
	WEnd
	Sleep(5000)
	send("!n",0)
	TraySetToolTip("Waiting for ZA installation to show the restart dialog")
	WinWaitActive("Configuration Wizard","&Restart Computer")
	
	
	;RESTART HAPPENS HERE
	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", "Rerun","REG_SZ",@AutoItExe)		
	RegWrite("HKEY_CURRENT_USER\SOFTWARE\AutoTool", "Runround","REG_SZ","8")	
	
	send("!r",0)	
EndIf

if $RunRound = "8" Then
	$os=@OSVersion
	if $os="WIN_VISTA" Then		
		run(@SystemDir  & "\DFRgui.exe")
		TraySetToolTip("Waiting for degfrag window")
		WinWaitActive("Disk Defragmenter")
		ControlClick("Disk Defragmenter","","[CLASS:Button; INSTANCE:7]")
		TraySetToolTip("Waiting for degfrag dialog")
		WinWaitActive("Disk Defragmenter: Defragment Now")
		Send("{ENTER}")
		TraySetToolTip("Waiting for degfrag to finish")
		WinWaitActive("Disk Defragmenter","Defragment &now...")
		WinClose("Disk Defragmenter")
		run(@SystemDir  & "\cleanmgr.exe")
	EndIf
	
	if $os="WIN_XP" Then
		Send("#r") 
		TraySetToolTip("Waiting for run dialog")
		WinWaitActive("Run")
		ControlSetText("Run","","[CLASS:Edit; INSTANCE:1]",@SystemDir  & "\dfrg.msc")
		ControlClick("Run","","[CLASS:Button; INSTANCE:2]")
		TraySetToolTip("Waiting for degfrag window")
		WinWaitActive("Disk Defragmenter")
		ControlClick("Disk Defragmenter","","[CLASS:Button; INSTANCE:1]")
		while True
			if WinActive("Disk Defragmenter","You should defragment this volume") Then
				ControlClick("[ACTIVE]","","[CLASS:Button; INSTANCE:4]")
				TraySetToolTip("Waiting for degfrag to finish")
				WinWaitActive("Disk Defragmenter","Defragmentation is complete")
				ControlClick("Disk Defragmenter","","[CLASS:Button; INSTANCE:5]")
				WinClose("Disk Defragmenter")
				ExitLoop
			EndIf
			if WinActive("Disk Defragmenter","You do not need to defragment this volume") Then
				ControlClick("Disk Defragmenter","","[CLASS:Button; INSTANCE:5]")
				WinClose("Disk Defragmenter")
				ExitLoop
			EndIf
		WEnd
	EndIf
	
	run("chkdsk /f")
	TraySetToolTip("Waiting for console")
	WinWaitActive("[CLASS:ConsoleWindowClass]")
	TraySetToolTip("sleeping for 2 sec")
	Sleep(2000)
	Send("Y{ENTER}")
	
	RegDelete("HKEY_CURRENT_USER\SOFTWARE\AutoTool")
	RegDelete("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", "Rerun")
	
	Shutdown (2)
EndIf
Func MyExit()
    Exit 
EndFunc 

