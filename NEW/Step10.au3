;Install Zone Alarm

#include <Date.au3>
#include <Timers.au3>

AutoItSetOption("SendKeyDelay",400)

$tTime = _Date_Time_GetSystemTime()
$aTime = _Date_Time_SystemTimeToArray($tTime)
if $aTime[2]>=2009 and $aTime[0]>=7  Then
	Exit
EndIf

run("ZoneAlarmFull.exe")
TraySetToolTip("Waiting for ZA setup to startup")
WinWaitActive("ZoneAlarm Installation","Installation",120)
if WinActive("ZoneAlarm Installation","Installation")=0 Then
	if WinActive("ZoneAlarm  Setup","Click OK to start this SP update")=1 Then
		;KB943232
		Send("{ENTER}")
		WinWaitActive("Software Update Installation Wizard","Hotfix for Windows XP",10)
		if WinActive("Software Update Installation Wizard","Hotfix for Windows XP")=0 Then
			ProcessClose("update.exe")
			Exit
		EndIf
		Send("!n",0)
		WinWaitActive("Software Update Installation Wizard","PLEASE NOTE")
		Send("!a",0)
		Send("!n",0)
		WinWaitActive("Software Update Installation Wizard","To apply the changes")
		Send("{ENTER}")
		run("ZoneAlarmFull.exe")
		WinWaitActive("ZoneAlarm Installation","Installation",120)
	EndIf
EndIf


ControlClick("ZoneAlarm Installation","","[CLASS:Button; INSTANCE:6]")
Send("!n",0)
TraySetToolTip("Waiting for ZA registration dialog")
WinWaitActive("ZoneAlarm Registration")
if WinActive("ZoneAlarm Registration")=0 Then
	ProcessClose("ZoneAl~1.exe")
	WinKill("ZoneAlarm Registration")
	Exit
EndIf
ControlSetText("ZoneAlarm Registration","","[CLASS:Edit; INSTANCE:1]","test")
ControlSetText("ZoneAlarm Registration","","[CLASS:Edit; INSTANCE:2]","test@test.com")
ControlClick("ZoneAlarm Registration","","[CLASS:Button; INSTANCE:1]")
Send("!n",0)
TraySetToolTip("Waiting for ZA installation to continue")
WinWaitActive("ZoneAlarm Installation","LICENSE AGREEMENT",10)
if WinActive("ZoneAlarm Installation","LICENSE AGREEMENT")=0 Then
	ProcessClose("ZoneAl~1.exe")
	WinKill("ZoneAlarm Installation")
	Exit
EndIf
ControlClick("ZoneAlarm Installation","","[CLASS:Button; INSTANCE:4]")
Send("!i",0)

TraySetToolTip("Waiting for ZA installation to finish")
while True
	if WinExists("Windows Security") Then
		WinActivate("Windows Security")
		ControlClick("Windows Security","","[CLASS:Button; INSTANCE:1]")
	endif
	if WinExists("Configuration Wizard") Then
		WinActivate("Configuration Wizard")
		WinWaitActive("Configuration Wizard")
		ExitLoop
	EndIf	
WEnd
Send("!d",0)		
Send("!n",0)		
WinWaitActive("Configuration Wizard","&Do not set up",10)
Send("!n",0)
Sleep(5000)
send("!n",0)
TraySetToolTip("Waiting for ZA installation to show the restart dialog")
WinWaitActive("Configuration Wizard","&Restart Computer")
	
	
;RESTART HAPPENS HERE BUT DO NOT DO IT
