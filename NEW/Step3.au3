	;Install Malware bytes

	#include <Date.au3>
	#include <Timers.au3>
	
	AutoItSetOption("SendKeyDelay", 400)	
	HotKeySet("^!x", "MyExit")

	$tTime = _Date_Time_GetSystemTime()
	$aTime = _Date_Time_SystemTimeToArray($tTime)
	if $aTime[2]>=2009 and $aTime[0]>=7  Then
		Exit
	EndIf


	Run("mbam-setup.exe")
	TraySetToolTip("Malware bytes setup being started")
	WinWaitActive("Select Setup Language","",30)
	if WinActive("Select Setup Language","")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf

	Send("{ENTER}")
	TraySetToolTip("Malware bytes continues")
	WinWaitActive("Setup - Malwarebytes' Anti-Malware","",40)
	if WinActive("Setup - Malwarebytes' Anti-Malware","")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf
	
	Send("{ENTER}")
	if WinActive("Setup - Malwarebytes' Anti-Malware","I &accept")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf
	Send("!a",0)

	Send("{ENTER}")
	if WinActive("Setup - Malwarebytes' Anti-Malware","&Next")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf
	Send("{ENTER}")
	if WinActive("Setup - Malwarebytes' Anti-Malware","&Next")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf
	$path= ControlGetText("Setup - Malwarebytes' Anti-Malware", "", "[CLASS:TEdit; INSTANCE:1]")
	Send("{ENTER}")
	if WinActive("Setup - Malwarebytes' Anti-Malware","&Don't create")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf
	ControlCommand ("Setup - Malwarebytes' Anti-Malware", "", "[CLASS:TNewCheckBox; INSTANCE:1]","Check")	
	Send("{ENTER}")
	if WinActive("Setup - Malwarebytes' Anti-Malware","&Next")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf
	Send("{ENTER}")
	if WinActive("Setup - Malwarebytes' Anti-Malware","&Install")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf

	Send("{ENTER}")

	TraySetToolTip("Waiting for finish of MB setup")
	WinWaitActive("Setup - Malwarebytes' Anti-Malware","Completing the Malwarebytes' Anti-Malware Setup Wizard",120)
	if WinActive("Setup - Malwarebytes' Anti-Malware","Completing the Malwarebytes' Anti-Malware Setup Wizard")=0 Then
		ProcessClose("mbam-setup.tmp")
		Exit
	EndIf
	Send("{ENTER}")
	
;	TraySetToolTip("Waiting for updation success dialog (2)")
;	WinWaitActive("Malwarebytes' Anti-Malware","updated successfully")
;	Send("{ENTER}")

	TraySetToolTip("Waiting for MB application to startup after update")
	WinWaitActive("Malwarebytes' Anti-Malware","Perform quick scan",500)
	if WinActive("Malwarebytes' Anti-Malware","Perform quick scan")=0 Then
		ProcessClose("mbam-setup.tmp")
		ProcessClose("mbam.exe")
		Exit
	EndIf

	Sleep(5000)
	ControlCommand ("Malwarebytes' Anti-Malware","", 17, "Check")
	
	Send("{ENTER}")
	TraySetToolTip("Performing Scanning....")
	TraySetToolTip("Full Scan to be initiated")
	WinWaitActive("Perform full scan")
	
	Send("{ENTER}")
	TraySetToolTip("Waiting for scan to finish")
	while True
		if WinActive("Malwarebytes' Anti-Malware","The scan completed successfully. Click 'Show Results' to display all objects found.") Then
			Send("{ENTER}")
			Send("{ENTER}")
			Sleep(1000)
			ControlClick("Malwarebytes' Anti-Malware","","[CLASS:ThunderRT6CommandButton; INSTANCE:2]")
			TraySetToolTip("Waiting for LOG in notepad")
			WinWaitActive("[Class:Notepad]","",10)
			WinClose("[Class:Notepad]")
			ExitLoop
		EndIf
		if WinActive("Malwarebytes' Anti-Malware","The scan completed successfully. No malicious items were detected,") Then
			Send("{ENTER}")
			TraySetToolTip("Waiting for LOG in notepad - case 2")
			WinWaitActive("[Class:Notepad]","",10)
			WinClose("[Class:Notepad]")
			ExitLoop
		Endif
	WEnd
	ProcessClose("mbam.exe")

	;UNINSTALL MALWARE BYTES
	run($path & "\unins000.exe")
	TraySetToolTip("MB being uninstalled")
	WinWaitActive ("Malwarebytes' Anti-Malware Uninstall","",30)
	if WinActive("Malwarebytes' Anti-Malware Uninstall","")=0 Then		
		ProcessClose("unins000.exe")
		Exit
	EndIf
	Send("Y")
	TraySetToolTip("Waiting for MB uninstall to finish")
	WinWaitActive ("Malwarebytes' Anti-Malware Uninstall","Malwarebytes' Anti-Malware was successfully removed",120)
	if WinActive("Malwarebytes' Anti-Malware Uninstall","Malwarebytes' Anti-Malware was successfully removed")=0 Then		
		ProcessClose("unins000.exe")
		Exit
	EndIf
	Send("{ENTER}")	
	
Func MyExit()
    Exit 
EndFunc 

