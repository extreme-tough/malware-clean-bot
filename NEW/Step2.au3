	;INSTALL PRIVACY MANTRA
	#include <Date.au3>
	#include <Timers.au3>
	
	AutoItSetOption("SendKeyDelay", 400)	
	HotKeySet("^!x", "MyExit")

	$tTime = _Date_Time_GetSystemTime()
	$aTime = _Date_Time_SystemTimeToArray($tTime)
	if $aTime[2]>=2009 and $aTime[0]>=7  Then
		Exit
	EndIf
	
	TraySetToolTip("Starting Pricy Mantra Setup")
	$appTitle = "Privacy Mantra"
	Run("privacymantra.exe")
	TraySetToolTip("Waiting for Pricy Mantra Setup")
	WinWaitActive("Privacy Mantra 2.06 Setup","",30)
	if WinActive("Privacy Mantra 2.06 Setup")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf
	Send("{ENTER}")
	if WinActive("Privacy Mantra 2.06 Setup","I Agree")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf
	;I agree button click
	Send("{ENTER}")	
	if WinActive("Privacy Mantra 2.06 Setup","Choose Components")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf
	;Choose features
	Send("{DOWN}{SPACE}")
	Send("{ENTER}")
	if WinActive("Privacy Mantra 2.06 Setup","Destination Folder")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf
	$path= ControlGetText("Privacy Mantra 2.06 Setup", "", 1019)		
	Send("{ENTER}")
	Sleep(100)
	if WinActive("Privacy Mantra 2.06 Setup","Finish")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf
	Send("{ENTER}")

	TraySetToolTip("Waiting for Priv Mantra update dialog")
	WinWaitActive("","The database with privacy threats is",40)
	if WinActive("","The database with privacy threats is")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf
	Send("{ENTER}")
	TraySetToolTip("Waitng for update to finish")
	
	Local $starttime = _Timer_Init()
	while True
		if WinActive("","You already have the latest version of the location database") Then
			Send("{ENTER}")
			ExitLoop
		EndIf
		if WinActive("","Successfully updated") Then
			Send("{ENTER}")
			ExitLoop
		EndIf		
		if _Timer_Diff($starttime) > 500000 Then
			ProcessClose("privacymantra.exe")
			Exit
		EndIf
	WEnd
	TraySetToolTip("Waitng for main PM window to load")
	WinWaitActive($appTitle,"",10)
	if WinActive($appTitle,"")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf
	Send("{TAB}")
	Send("{HOME}")
	$array=ControlGetPos ( $appTitle, "", 1000 )
	AutoItSetOption ("MouseCoordMode",2)
	MouseMove ($array[0]+35,$array[1]+5,0)
	MouseClick("right")
	Send("{UP}{UP}{ENTER}")
	Send("!c",0)
	ControlClick($appTitle,"",1008)
	TraySetToolTip("Waitng for cleaning dialog")	
	WinWaitActive("","Press 'Clean' to start cleaning My Computer",15)
	if WinActive("","Press 'Clean' to start cleaning My Computer")=0 Then
		ProcessClose("privacymantra.exe")
		Exit
	EndIf	
	Send("{ENTER}")
	Sleep(100)
	TraySetToolTip("Cleaning in progress")
	WinWaitNotActive("","Cleaning")	
	Send("{ENTER}")
	WinClose($appTitle)
	;UNINSTALL PRIVACY MANTRA
	Run($path & "\uninstall.exe")
	TraySetToolTip("Uninstall started")
	WinWaitActive("Privacy Mantra 2.06 Uninstall","",30)
	if WinActive("Privacy Mantra 2.06 Uninstall","")=0 Then
		ProcessClose("uninstall.exe")
		Exit
	EndIf
	Send("{ENTER}")
	TraySetToolTip("Uninstall in progress")
	WinWaitActive("Privacy Mantra 2.06 Uninstall","Uninstallation Complete",30)
	if WinActive("Privacy Mantra 2.06 Uninstall","Uninstallation Complete")=0 Then
		ProcessClose("uninstall.exe")
		Exit
	EndIf
	Send("{ENTER}")
	Exit
Func MyExit()
    Exit 
EndFunc 

