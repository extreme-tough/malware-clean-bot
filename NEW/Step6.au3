;INSTALL ADAWARE PRO

#include <Date.au3>
#include <Timers.au3>

AutoItSetOption("SendKeyDelay", 400)	
HotKeySet("^!x", "MyExit")

$tTime = _Date_Time_GetSystemTime()
$aTime = _Date_Time_SystemTimeToArray($tTime)
if $aTime[2]>=2009 and $aTime[0]>=7  Then
	Exit
EndIf
$ReRun = ""
$ReRun = RegRead("HKEY_CURRENT_USER\SOFTWARE\AutoTool", "Continue")

if $ReRun="" Then
	RegDelete("HKEY_CURRENT_USER\SOFTWARE\AutoTool", "Continue")
	RegDelete("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", "Rerun")
	RUN("Ad-AwareAE_67.exe")
	TraySetToolTip("Adware setup running..")
	WinWaitActive ("Installation Wizard","Installation Wizard is verifying the contents",30)
	if WinActive("Installation Wizard","Installation Wizard is verifying the contents")=0 Then
		ProcessClose("Ad-AwareAE_67.e")
		Exit
	EndIf
	TraySetToolTip("Wait for setup language")
	While True
		if WinActive("Select Setup Language","&OK")=1 Then
			Send("{ENTER}")
			ExitLoop
		EndIf		
		if WinActive("Ad-Aware - InstallAware Wizard","Uninstall")=1 Then
			;Uninstallation found
			ControlClick("Ad-Aware - InstallAware Wizard","Uninstall","[CLASS:TButton; INSTANCE:1]")
			WinWaitActive ("Ad-Aware - InstallAware Wizard","&Restart now",240)
			if WinActive("Ad-Aware - InstallAware Wizard","&Restart now")=0 Then
				ProcessClose("Ad-AwareAE.exe")
				Exit
			EndIf
			RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", "Rerun","REG_SZ",@AutoItExe)
			RegWrite("HKEY_CURRENT_USER\SOFTWARE\AutoTool", "Continue","REG_SZ","")
			Send("!f",0)
			Exit		
		EndIf
	WEnd
	
	TraySetToolTip("Waiting for setup to be active")
	WinWaitActive ("Ad-Aware - InstallAware Wizard","&Next >",240)
	if WinActive("Ad-Aware - InstallAware Wizard","&Next >")=0 Then
		ProcessClose("Ad-AwareAE.exe")
		Exit
	EndIf
	Send("{ENTER}")

	TraySetToolTip("Waiting for license screen")
	WinWaitActive ("Ad-Aware - InstallAware Wizard","I &accept the terms of the license agreement",5)
	if WinActive("Ad-Aware - InstallAware Wizard","I &accept the terms of the license agreement")=0 Then
		ProcessClose("Ad-AwareAE.exe")
		Exit
	EndIf
	Send("!a",0)
	Send("{ENTER}",0)

	TraySetToolTip("Waiting for last step")
	WinWaitActive ("Ad-Aware - InstallAware Wizard","&Restart now",240)
	if WinActive("Ad-Aware - InstallAware Wizard","&Restart now")=1 Then
		;RESTART HAPPENS HERE
		RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", "Rerun","REG_SZ",@AutoItExe)
		RegWrite("HKEY_CURRENT_USER\SOFTWARE\AutoTool", "Continue","REG_SZ","Y")
		Send("!f",0)
		Sleep(5000)
		Shutdown(2)
		Exit		
	EndIf
	$ReRun="Y"
EndIf

if $ReRun="Y" Then
	RegDelete("HKEY_CURRENT_USER\SOFTWARE\AutoTool", "Continue")
	RegDelete("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", "Rerun")
	$InstallPath = RegRead("HKEY_LOCAL_MACHINE\SOFTWARE\Lavasoft\Ad-Aware","InstallDirectory")	
	
	Run($InstallPath  & "Ad-Aware.exe")
	TraySetToolTip("Waiting for application to run")
	WinWaitActive("Ad-Aware")
	AutoItSetOption ("MouseCoordMode",2)
	AutoItSetOption ("PixelCoordMode",2)
	
	$array=WinGetClientSize("Ad-Aware")
	;Move to Scan
	MouseMove ($array[0]/2 ,$array[1]/4,0)
	Sleep(1000)
	MouseClick("left")	
	;Select Full Scan
 	MouseMove ($array[0]/2 ,($array[1]/4) + ($array[1]/16) ,0)
	Sleep(1000)
	MouseClick("left")	
	;Click Scan Now
	MouseMove ($array[0]/2 ,($array[1]/2) + ($array[1]/3) ,0)
	Sleep(1000)
	MouseClick("left")	
	$X=MouseGetPos(0)
	$Y=MouseGetPos(1)
	Sleep(2000)
  	$CSum = PixelChecksum($X-150,$Y - 150,$X + 150, $Y+150,1,WinGetHandle ("[ACTIVE]"))
	$CSumNew = $CSum
	While $CSumNew = $CSum
		$CSumNew = PixelChecksum($X-150,$Y - 150,$X + 150, $Y+150,1,WinGetHandle ("[ACTIVE]"))
	WEnd
	Sleep(1000)
	MouseClick("left")	
	Sleep(60000)


	ProcessClose("Ad-Aware.exe")
	ProcessClose("AAWTray.exe")
	RUN("Ad-AwareAE_67.exe")
	WinWaitActive("Ad-Aware - InstallAware Wizard","Uninstall")
	ControlClick("Ad-Aware - InstallAware Wizard","Uninstall","[CLASS:TButton; INSTANCE:1]")
	WinWaitActive ("Ad-Aware - InstallAware Wizard","&Restart now",240)
	if WinActive("Ad-Aware - InstallAware Wizard","&Restart now")=0 Then
		ProcessClose("Ad-AwareAE.exe")
		Exit
	EndIf
	RegDelete("HKEY_CURRENT_USER\SOFTWARE\AutoTool", "Continue")
	RegDelete("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", "Rerun")
	Send("!f",0)
	Shutdown(2)
	Exit		

EndIf


Func MyExit()
    Exit 
EndFunc 

