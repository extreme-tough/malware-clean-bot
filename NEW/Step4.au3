;Install Clamwin

#include <Date.au3>
#include <Timers.au3>

AutoItSetOption("SendKeyDelay", 400)	
HotKeySet("^!x", "MyExit")

$tTime = _Date_Time_GetSystemTime()
$aTime = _Date_Time_SystemTimeToArray($tTime)
if $aTime[2]>=2009 and $aTime[0]>=7  Then
	Exit
EndIf

ProcessClose("ClamTray.exe")
ProcessClose("ClamWin.exe")

$PID = run("clamwin-0.95.1-setup.exe")
TraySetToolTip("Clamwin setup running")
WinWaitActive("Setup - ClamWin Free Antivirus","",30)

if WinActive("Setup - ClamWin Free Antivirus","")=0 Then
	ProcessClose($PID)
	Exit
EndIf

Send("{ENTER}")
if WinActive("Setup - ClamWin Free Antivirus","I &accept")=0 Then
	ProcessClose($PID)
	Exit
EndIf

Send("!a",0)
Send("{ENTER}")
if WinActive("Setup - ClamWin Free Antivirus","Who should this application")=0 Then
	ProcessClose($PID)
	Exit
EndIf
Send("{ENTER}")

$path= ControlGetText("Setup - ClamWin Free Antivirus", "", "[CLASS:TEdit; INSTANCE:1]")
Send("{ENTER}")
if WinActive("Setup - ClamWin Free Antivirus","&Next")=0 Then
	ProcessClose($PID)
	Exit
EndIf
Send("{ENTER}")
if WinActive("Setup - ClamWin Free Antivirus","&Don't create a Start Menu")=0 Then
	ProcessClose($PID)
	Exit
EndIf	
ControlCommand ("Setup - ClamWin Free Antivirus","", "[CLASS:TCheckBox; INSTANCE:1]", "Check")
Send("{ENTER}")
if WinActive("Setup - ClamWin Free Antivirus","Select the additional tasks")=0 Then
	ProcessClose($PID)
	Exit
EndIf	
Send("{ENTER}")
if WinActive("Setup - ClamWin Free Antivirus","&Install")=0 Then
	ProcessClose($PID)
	Exit
EndIf	
Send("{ENTER}")
if WinActive("Setup","detected previous version")=1 Then
	Send("{ENTER}")
EndIf	
TraySetToolTip("Waiting for Clamwin setup to finish")
WinWaitActive("Setup - ClamWin Free Antivirus","Completing the ClamWin Free Antivirus Setup Wizard",300)
if WinActive("Setup - ClamWin Free Antivirus","Completing the ClamWin Free Antivirus Setup Wizard")=0 Then
	ProcessClose($PID)
	Exit
EndIf	
Send("{ENTER}")



Run($path & "\bin\clamwin.exe")
TraySetToolTip("Starting Clamwin")
WinWaitActive("ClamWin Free Antivirus","",30)
if WinActive("ClamWin Free Antivirus","Virus signature database is older")=1 Then
	Send("!y",0)	
	WinWaitActive("ClamWin Free Antivirus","&Close",300)
	if WinActive("ClamWin Free Antivirus","&Close")=0 Then
		ProcessClose("ClamTray.exe")
		ProcessClose("ClamWin.exe")
		Exit
	EndIf
	Send("!c",0)	
EndIf
Send("!s",0)
TraySetToolTip("Clasmwin Scanning started")
WinWaitActive("ClamWin Free Antivirus: Scanning...","Completed")
Send("{ENTER}")
TraySetToolTip("Wait for Clamwin scanning to finish")
WinWaitActive("ClamWin Free Antivirus")
Send("!c",0)


Func MyExit()
    Exit 
EndFunc 

