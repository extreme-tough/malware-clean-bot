	;INSTALL CCCLEANER
	AutoItSetOption("SendKeyDelay", 400)	
	HotKeySet("^!x", "MyExit")
	
	TraySetToolTip("Starting ccsetup215.exe")

	Run("ccsetup219")
	; Wait for the active 
	TraySetToolTip("Waiting for language dialog") 
	WinWaitActive("Installer Language","",30)
	if WinActive("Installer Language")=0 Then
		ProcessClose("ccsetup219.exe")
		Exit
	EndIf
	$appTitle = "Piriform CCleaner"
	
	Send("{ENTER}") 
	if WinActive("CCleaner v2.19 Setup","Click Next")=0 Then
		ProcessClose("ccsetup219.exe")
		Exit
	EndIf	
	Send("{ENTER}")
	if WinActive("CCleaner v2.19 Setup","License Agreement")=0 Then
		ProcessClose("ccsetup219.exe")
		Exit
	EndIf		
	Send("{ENTER}")		
	Sleep(100)
	if WinActive("CCleaner v2.19 Setup","Destination Folder")=0 Then
		ProcessClose("ccsetup219.exe")
		Exit
	EndIf		
	$path= ControlGetText("CCleaner v2.19 Setup", "", 1019)
	if $path="" Then	
		MsgBox (0, "Error - Cannot read path of installation of CCleaner. Exiting...")
		Exit
	EndIf
	TraySetToolTip("Waiting for setup dialog to finish")
	Send("{ENTER}")
	if WinActive("CCleaner v2.19 Setup","Add Desktop Shortcut")=0 Then
		ProcessClose("ccsetup219.exe")
		Exit
	EndIf	
	Send("{SPACE}{TAB}{SPACE}{TAB}{SPACE}{TAB}{SPACE}{TAB}{TAB}{SPACE}")	
	Send("{ENTER}")
	WinWaitActive("CCleaner v2.19 Setup","Completing the CCleaner v2.19 Setup Wizard",60)
	if WinActive("CCleaner v2.19 Setup","Completing the CCleaner v2.19 Setup Wizard")=0 Then
		ProcessClose("ccsetup219.exe")
		Exit
	EndIf	
	Send("{ENTER}")
	Sleep(100)

	;RUN THE CCLEANER
	TraySetToolTip("Running CCleaner")
	Run($path & "\CCleaner.exe")		
	TraySetToolTip("Waiting for App to show up")
	WinWaitActive($appTitle,"",60)
	if WinActive($appTitle,"Run Cleaner")=0 Then
		ProcessClose("CCleaner.exe")
		Exit
	EndIf	
	Send("!a",0)	
	Sleep(100)
	
	while ControlCommand($appTitle,"",1021,"IsEnabled", "")<>1
	WEnd
	Send("!r",0)	
	TraySetToolTip("Waiting for 5 secs")
	Sleep(5000)
	;TODO Analyze this. This may never happen	
	TraySetToolTip("Waiting for file deletion warning")
	if WinActive("","This process will permanently delete") Then
		Send("{ENTER}")
	EndIf
	$ctext=ControlGetText  ($appTitle,"",1075)
	while StringInStr($ctext,"CLEANING COMPLETE")=0
		$ctext=ControlGetText  ($appTitle,"",1075)
	WEnd
	WinClose($appTitle)

	;UNINSTALL THE APPLICATION
	Run($path & "\uninst.exe")
	TraySetToolTip("Waiting for Uninstall application")
	WinWaitActive("CCleaner v2.19 Uninstall")
	Send("{ENTER}")
	Send("{ENTER}")
	TraySetToolTip("Waiting for uninstall to finish")
	WinWaitActive("CCleaner v2.19 Uninstall","Completing the CCleaner v2.19 Uninstall Wizard")
	Send("{ENTER}")
	
Func MyExit()
    Exit 
EndFunc 

